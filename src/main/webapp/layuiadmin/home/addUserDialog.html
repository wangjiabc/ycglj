<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>添加弹出层</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" type="text/css" href="../layui/css/layui.css" />
    <link rel="stylesheet" href="../style/admin.css" media="all">
</head>

<body>
    <form class="layui-form" style="margin:20px;">
        <div class="layui-form-item">
            <label class="layui-form-label">姓 名</label>
            <div class="layui-input-inline">
                <input name="name" type="text" lay-filter="name" lay-verify="required" placeholder="姓 名" autocomplete="off"
                    class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">手机号</label>
            <div class="layui-input-inline">
                <input name="phone" type="text" lay-filter="phone" lay-verify="required|phone" placeholder="手机号"
                    autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">地址</label>
            <div class="layui-input-inline">
                <input name="address" type="text" lay-filter="address" lay-verify="required" placeholder="营业地址"
                    autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">身份证号</label>
            <div class="layui-input-inline">
                <input name="number" type="text" lay-filter="number" lay-verify="required|identity" placeholder="身份证号"
                    autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">许可证号</label>
            <div class="layui-input-inline">
                <input name="license" type="text" lay-filter="license" lay-verify="required" placeholder="许可证号"
                    autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">所属中队</label>
            <div class="layui-input-inline">
                <select lay-filter="region" lay-verify="required" name="region">
                    <option value="">请选择所属中队</option>
                    <option value="白沙中队">白沙中队</option>
                    <option value="城区中队">城区中队</option>
                    <option value="九支中队">九支中队</option>
                    <option value="榕山中队">榕山中队</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">所属业态</label>
            <div class="layui-input-inline">
                <select lay-filter="business_status" lay-verify="required" name="business_status">
                    <option value="">请选择所属业态</option>
                    <option value="食杂店">食杂店</option>
                    <option value="便利店">便利店</option>
                    <option value="超市">超市</option>
                    <option value="商场">商场</option>
                    <option value="烟酒店">烟酒店</option>
                    <option value="娱乐服务">娱乐服务</option>
                    <option value="路边摊">路边摊</option>
                    <option value="其它">其它</option>
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">到期日期</label>
            <div class="layui-input-inline">
                <input type="text" class="layui-input" lay-verify="required" id="license_end_time" lay-filter="license_end_time"
                    placeholder="许可证到期日期">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block" style="float:right">
                <button id="save" lay-submit lay-filter="save" class="layui-btn layui-btn-normal">添加信息</button>
            </div>
        </div>

    </form>


    <script src="https://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
    <script src="../layui/layui.js"></script>
    <script>
        layui.use(['layer', 'form', 'laydate'], function () {
            var layer = layui.layer,
                form = layer.form,
                laydate = layui.laydate;
            var license_end_time;
            //常规用法
            laydate.render({
                elem: '#license_end_time'
                , done: function (value, date, endDate) {
                    console.log(value); //得到日期生成的值，如：2017-08-18
                    license_end_time = value;
                }

            });
            layui.form.on('submit(save)', function (data) {
                console.log(data.field);
                console.log("in"+license_end_time);
                $.ajax({
                    type: "get",
                    url: "/ycglj/user/insertUser.do?name=" + data.field.name + "&idNumber=" + data.field.number + "&phone=" + data.field.phone + "&license=" + data.field.license + "&address=" + data.field.address + "&region=" + data.field.region + "&business_state=" + data.field.business_status + "&license_end_date=" + license_end_time,
                    contentType: 'application/x-www-form-urlencoded;charset=utf-8',
                    data: {},
                    dataType: "json",
                    success: function (data) {
                        if (data == 1) {
                            //提示成功 刷新界面
                            layer.alert('添加成功', { icon: 1 });
                            parent.layui.layer.closeAll('iframe');
                        } else if (data == -1) {
                            layer.msg('error', { icon: 2 });
                            parent.layui.layer.closeAll('iframe');
                        } else if (data == -2) {
                            layer.msg('许可证已存在', { icon: 2 });
                            parent.layui.layer.closeAll('iframe');
                        }

                        // window.parent.location.reload();
                    },
                    error: function (e) {
                        parent.layui.layer.closeAll('iframe');
                        console.log(e);
                    }
                })
            })
            return false;
        })

    </script>
</body>

</html>