<!doctype html>
<html>

<head>
  <meta charset="utf-8">
  <title>案件录入</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no,minimal-ui" />

  <script src="/ycglj/js/jquery.min.js"></script>
  <!--jquery weui-->
  <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.3/style/weui.min.css">
  <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.2.1/css/jquery-weui.min.css">

  <script type="text/javascript" src="/ycglj/mobile/singleton.js"></script>

  <script type="text/javascript">
    var redirectUrl = "https://open.weixin.qq.com/connect/oauth2/authorize?appid=" + APPID + "&redirect_uri=" + DOMAIN + "/ycglj/mobile/asset/index.html&response_type=code&scope=snsapi_base&state=STATE#wechat_redirect";
  </script>

  <script src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>

  <!-- <script type="text/javascript" src="../../asset/js/index.js"></script> -->
</head>
<style>
  .record{
    width:100%;
    height:auto;
}
.weui-label{
  width:55px;
}
.button_sp_area{
  margin: 10px;
  position: fixed;
  bottom: 5px;
  right:5px;
}
</style>

<body>
  <div class="weui-cells weui-cells_form">
    <div class="weui-cell">
      <div class="weui-cell__hd"><label for="date" class="weui-label">日期</label></div>
      <div class="weui-cell__bd">
        <input class="weui-input" id="date" type="text">
      </div>
    </div>
    <div class="weui-cell">
      <div class="weui-cell__hd"><label class="weui-label">姓名</label></div>
      <div class="weui-cell__bd">
        <input class="weui-input" id="name" type="text">
      </div>
      <div class="weui-cell__hd"><label class="weui-label">性别</label></div>
      <div class="weui-cell__bd">
        <input class="weui-input" id="sex" type="text">
      </div>
    </div>
    <div class="weui-cell">
      <div class="weui-cell__hd"><label class="weui-label">地址</label></div>
      <div class="weui-cell__bd">
        <input class="weui-input" id="address" type="text">
      </div>
    </div>
    <div class="weui-cell">
      <div class="weui-cell__hd"><label class="weui-label">证件号</label></div>
      <div class="weui-cell__bd">
        <input class="weui-input" id="idcard" type="text">
      </div>
    </div>
    <div class="weui-cell">
      <div class="weui-cell__hd"><label class="weui-label">电话</label></div>
      <div class="weui-cell__bd">
        <input class="weui-input" id="phone" type="text">
      </div>
    </div>
    <div class="weui-cell">
      <div class="weui-cell__hd"><label class="weui-label">备注</label></div>
      <textarea class="weui-textarea" id="remark" placeholder="" rows="3"></textarea>
    </div>

  </div>
  <div class="weui-cells">
    <div class="weui-flex">
      <div class="weui-flex__item">
        <div class="weui-cell">
          <div class="weui-cell__bd">
            <p>假冒</p>
          </div>
          <div class="weui-cell__ft">
            <div class="weui-count">
              <a class="weui-count__btn weui-count__decrease"></a>
              <input name="jm" class="weui-count__number" type="number" value="0" />
              <a class="weui-count__btn weui-count__increase"></a>
            </div>
          </div>
        </div>
      </div>
      <div class="weui-flex__item">
        <div class="weui-cell">
          <div class="weui-cell__bd">
            <p>非渠道</p>
          </div>
          <div class="weui-cell__ft">
            <div class="weui-count">
              <a class="weui-count__btn weui-count__decrease"></a>
              <input name="fqd" class="weui-count__number" type="number" value="0" />
              <a class="weui-count__btn weui-count__increase"></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="weui-flex">
      <div class="weui-flex__item">
        <div class="weui-cell">
          <div class="weui-cell__bd">
            <p>走私</p>
          </div>
          <div class="weui-cell__ft">
            <div class="weui-count">
              <a class="weui-count__btn weui-count__decrease"></a>
              <input name="zs" class="weui-count__number" type="number" value="0" />
              <a class="weui-count__btn weui-count__increase"></a>
            </div>
          </div>
        </div>
      </div>
      <div class="weui-flex__item">
          <div class="weui-cell">
            <div class="weui-cell__bd">
              <p>超邮</p>
            </div>
            <div class="weui-cell__ft">
              <div class="weui-count">
                <a class="weui-count__btn weui-count__decrease"></a>
                <input name="cy" class="weui-count__number" type="number" value="0" />
                <a class="weui-count__btn weui-count__increase"></a>
              </div>
            </div>
          </div>
        </div>
     
    </div>
    <div class="weui-flex" id="wz">
      <div class="weui-flex__item">
        <div class="weui-cell">
          <div class="weui-cell__bd">
            <p>无证经营</p>
          </div>
          <div class="weui-cell__ft">
            <div class="weui-count">
              <a class="weui-count__btn weui-count__decrease"></a>
              <input name="wzjy" class="weui-count__number" type="number" value="0" />
              <a class="weui-count__btn weui-count__increase"></a>
            </div>
          </div>
        </div>
      </div>
      <div class="weui-flex__item">
        <div class="weui-cell">
          <div class="weui-cell__bd">
            <p>无证运输</p>
          </div>
          <div class="weui-cell__ft">
            <div class="weui-count">
              <a class="weui-count__btn weui-count__decrease"></a>
              <input name="wzys" class="weui-count__number" type="number" value="0" />
              <a class="weui-count__btn weui-count__increase"></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="weui-flex">
      <div class="weui-flex__item">
        <div class="weui-cell">
          <div class="weui-cell__bd">
            <p>其它</p>
          </div>
          <div class="weui-cell__ft">
            <div class="weui-count">
              <a class="weui-count__btn weui-count__decrease"></a>
              <input name="other" class="weui-count__number" type="number" value="0" />
              <a class="weui-count__btn weui-count__increase"></a>
            </div>
          </div>
        </div>
      </div>
      <div class="weui-flex__item">
          <div class="weui-cell" id="wz1">
            <div class="weui-cell__bd">
              <p>无证批发</p>
            </div>
            <div class="weui-cell__ft">
              <div class="weui-count">
                <a class="weui-count__btn weui-count__decrease"></a>
                <input name="wzpf" class="weui-count__number" type="number" value="0" />
                <a class="weui-count__btn weui-count__increase"></a>
              </div>
            </div>
          </div>
        </div>
    </div>

  </div>
  <div class="button_sp_area">
    <a href="javascript:;" onclick="insertCase();" class="weui-btn weui-btn_mini weui-btn_primary">确认录入</a>
  </div>
  <script src="https://cdn.bootcss.com/jquery/1.11.2/jquery.min.js"></script>
  <script src="https://cdn.bootcss.com/jquery-weui/1.2.1/js/jquery-weui.min.js"></script>
  <script src="https://cdn.bootcss.com/fastclick/1.0.6/fastclick.js"></script>
  <script>
    $(function () {
      FastClick.attach(document.body);
    });
  </script>
  <script>

    function getQueryString(name) {
      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
      var r = window.location.search.substr(1).match(reg);
      if (r != null) return unescape(r[2]); return null;
    }

    $('#date').val(new Date().getFullYear() + '-' + (new Date().getMonth() + 1) + '-' + new Date().getDate());
    // $("#date").calendar({
    //   onChange: function (p, values, displayValues) {
    //     date = displayValues;
    //   }
    // });

    var MAX = 99, MIN = 0;
    //减
    $('.weui-count__decrease').click(function (e) {
      var $input = $(e.currentTarget).parent().find('.weui-count__number');
      var number = parseInt($input.val() || "0") - 1
      if (number < MIN) number = MIN;
      $input.val(number)
    })
    //加
    $('.weui-count__increase').click(function (e) {
      var $input = $(e.currentTarget).parent().find('.weui-count__number');
      var number = parseInt($input.val() || "0") + 1
      if (number > MAX) number = MAX;
      $input.val(number)
    })

    var license = getQueryString("license");
    var longitude = getQueryString("longitude");
    var latitude = getQueryString("latitude");

    //零售户添加案由
    if (license != null) {
      $('#wz').remove();
      $('#wz1').remove();
      $.ajax({
        type: "POST",
        url: "../../user/getRoomInfoByGUID.do",
        data: {
          "license": license
        },
        dataType: "json",
        error: function (request) {
          console.log(request);
        },
        success: function (text) {
          console.log(text);
          var obj = text.roomInfo;
          var license = obj.license;
          $('#name').val(obj.name);
          $('#sex').val(obj.sex);
          $('#address').val(obj.address);
          $('#idcard').val(obj.id_number);
          $('#phone').val(obj.phone);
        }
      });
    }
    //录入
    function insertCase() {
      //   $('#name').val()
      // $('#sex').val()
      // $('#age').val()
      // $('#address').val()
      // $('#idcard').val()
      // $('#phone').val()
      // $('#note').val()
      var ay = [];
      var type;
      $("input[type='number']").each(function () {
        //循环需要录入的案件
        if ($(this).val() > 0) {
          type = $(this).parents('.weui-cell').find('p').text();
          ay.push(type, $(this).val());
        }
      });
      var remark = $("#remark").val();
      var date = $("#date").val();
      console.log(remark + " , " + date + "," + ay);

      $.ajax({
        type: "POST",
        url: "../../user/insertIntoCrimalCase.do",
        data: {
          "license": license,
          "dateTime": date,
          "ay": JSON.stringify(ay),
          "remark": remark,
          "lng": longitude,
          "lat": latitude
        },
        dataType: "json",
        error: function (request) {
          console.log(request);
        },
        success: function (text) {
          if (text > 0) {
            alert("新建记录成功!");
            history.back();
          } else if (text == -1) {
            alert("新建记录失败,至少选择一项违法记录!");
          } else {
            alert("新建记录失败!");
          }
        }
      });

    }

  </script>

</body>

</html>